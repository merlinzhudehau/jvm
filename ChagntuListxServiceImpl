/*
 *    Copyright (c) 2018-2025, lengleng All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice,
 * this list of conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright
 * notice, this list of conditions and the following disclaimer in the
 * documentation and/or other materials provided with the distribution.
 * Neither the name of the pig4cloud.com developer nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 * Author: lengleng (wangiegie@gmail.com)
 */
package com.pig4cloud.pigx.vehicle.service.impl;

import cn.hutool.core.bean.BeanUtil;
import com.baomidou.dynamic.datasource.annotation.DS;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.pig4cloud.pigx.vehicle.entity.ChagntuListx;
import com.pig4cloud.pigx.vehicle.mapper.ChagntuListxMapper;
import com.pig4cloud.pigx.vehicle.service.ChagntuListxService;
import com.pig4cloud.pigx.vehicle.service.VehicleserviceDriverService;
import com.pig4cloud.pigx.vehicle.vo.ChagntuListxVO;
import lombok.Data;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

/**
 * @author pigx code generator
 * @date 2021-07-21 13:49:56
 */
@Service
public class ChagntuListxServiceImpl extends ServiceImpl<ChagntuListxMapper, ChagntuListx> implements ChagntuListxService {

    @Autowired
    private VehicleserviceDriverService vehicleserviceDriverService;

    @Autowired
    private ChagntuListxMapper chagntuListxMapper;

    @Override
    public Boolean syncDate(List<String> waybillNos) {

        List<ChagntuListxVO> list = vehicleserviceDriverService.queryDateByWaybill(waybillNos);
        for (ChagntuListxVO chagntuListxVO : list) {
            if ("外六海通".equals(chagntuListxVO.get发货单位())) {
                chagntuListxVO.set发货单位("外六海");
                if (StringUtils.isNotEmpty(chagntuListxVO.get作业类型())) {
                    if (chagntuListxVO.get作业类型().contains("长途")) {
                        chagntuListxVO.set作业类型("长途");
                    }
                    if (chagntuListxVO.get作业类型().contains("市内")) {
                        chagntuListxVO.set作业类型("市内");
                    }
                    if (chagntuListxVO.get作业类型().contains("短驳")) {
                        chagntuListxVO.set作业类型("短驳");
                    }
                    if (!"市内长途短驳".contains(chagntuListxVO.get作业类型())) {
                        continue;
                    }
                    chagntuListxVO.set收货单位(chagntuListxVO.get收货单位() + "-" + chagntuListxVO.get经销店代码());
                    ChagntuListx chagntuListx = new ChagntuListx();
                    BeanUtil.copyProperties(chagntuListxVO, chagntuListx);
                    chagntuListx.set身份证号(com.pig4cloud.pigx.vehicle.utils.SecurityUtils.outSecurity(chagntuListxVO.getDriverLicenseNo(), chagntuListxVO.getLicenseNoKey()));
                    chagntuListxMapper.insert(chagntuListx);
                }

            }

        }


        return true;
    }
}
